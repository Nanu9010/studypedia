{% extends 'base.html' %}
{% load static %}

{% block title %}My Purchases - StudyPedia{% endblock %}

{% block content %}
<div class="max-w-[1440px] mx-auto w-full px-4 md:px-8 py-12">

    <div class="flex items-center justify-between border-b border-black pb-6 mb-8 mt-4">
        <div>
            <h1 class="text-4xl font-light font-display uppercase tracking-tight text-black mb-2">My Purchases</h1>
            <p class="text-sm text-gray-500 font-light">Your digital study materials library — all paid items ready to download.</p>
        </div>
        <div class="hidden sm:flex items-center gap-2">
            <span class="inline-block text-[10px] font-bold uppercase tracking-wider px-3 py-1 bg-black text-white">{{ purchases|length }} Item{{ purchases|length|pluralize }}</span>
        </div>
    </div>

    {% if messages %}
        <div class="flex flex-col gap-2 mb-8">
            {% for message in messages %}
                <div class="p-4 border border-black text-sm font-bold uppercase tracking-widest 
                    {% if message.tags == 'error' %}bg-red-50 text-red-600 border-red-200
                    {% elif message.tags == 'success' %}bg-green-50 text-green-600 border-green-200
                    {% else %}bg-gray-50 text-black{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% if purchases %}
        <div class="flex flex-col gap-4">
            {% for purchase in purchases %}
                <div class="bg-white border border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-4 md:p-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 group hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-shadow">
                    
                    <!-- Item Icon + Info -->
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 bg-gray-100 border border-black flex items-center justify-center shrink-0">
                            {% if purchase.content_type.model == 'note' %}
                                <span class="material-symbols-outlined text-2xl text-black">menu_book</span>
                            {% else %}
                                <span class="material-symbols-outlined text-2xl text-black">description</span>
                            {% endif %}
                        </div>
                        <div>
                            <h3 class="font-bold text-black text-lg leading-tight mb-1">
                                {{ purchase.item.name|default:"Unknown Item" }}
                            </h3>
                            <div class="flex items-center gap-3 flex-wrap">
                                <span class="text-[10px] font-mono uppercase tracking-widest text-gray-500 bg-gray-100 px-2 py-0.5">
                                    {{ purchase.content_type.name|capfirst }}
                                </span>
                                <span class="text-[10px] font-mono uppercase tracking-widest text-gray-500">
                                    {{ purchase.created_at|date:"M d, Y" }}
                                </span>
                                {% if purchase.amount_paid > 0 %}
                                    <span class="text-[10px] font-mono text-black bg-white border border-black px-2 py-0.5">₹{{ purchase.amount_paid }}</span>
                                {% endif %}
                                {% if purchase.credits_used > 0 %}
                                    <span class="text-[10px] font-mono text-black bg-white border border-black px-2 py-0.5">
                                        <span class="material-symbols-outlined text-[12px] align-middle">toll</span> {{ purchase.credits_used }} CR
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Status + Action -->
                    <div class="flex items-center gap-3 shrink-0 ml-auto">
                        <span class="inline-block text-[10px] font-bold uppercase tracking-wider px-2 py-1 border
                            {% if purchase.status == 'paid' %}border-green-500 text-green-700 bg-green-50
                            {% else %}border-orange-400 text-orange-700 bg-orange-50{% endif %}">
                            {{ purchase.status|capfirst }}
                        </span>
                        {% if purchase.status == 'paid' and purchase.item.pdf_file %}
                            <a href="{% url 'ecommerce:download_item' purchase.object_id %}?type={{ purchase.content_type.model }}"
                               class="flex items-center gap-2 border border-black bg-black text-white hover:bg-white hover:text-black transition-colors px-4 h-10 text-xs font-bold uppercase tracking-widest shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-0.5 hover:translate-y-0.5">
                                <span class="material-symbols-outlined text-[16px]">download</span> Download
                            </a>
                        {% elif purchase.status == 'paid' %}
                            <span class="text-[10px] font-mono text-gray-400 uppercase tracking-widest">File unavailable</span>
                        {% else %}
                            <span class="text-[10px] font-mono text-yellow-600 uppercase tracking-widest border border-yellow-400 px-2 py-1">Pending payment</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Quick Links -->
        <div class="mt-8 flex flex-wrap gap-4">
            <a href="{% url 'ecommerce:marketplace' %}" class="flex items-center gap-2 border border-black hover:bg-black hover:text-white transition-colors px-6 h-10 text-xs font-bold uppercase tracking-widest text-black">
                <span class="material-symbols-outlined text-[16px]">storefront</span> Marketplace
            </a>
            <a href="{% url 'ecommerce:order_history' %}" class="flex items-center gap-2 border border-black hover:bg-black hover:text-white transition-colors px-6 h-10 text-xs font-bold uppercase tracking-widest text-black">
                <span class="material-symbols-outlined text-[16px]">receipt_long</span> Order History
            </a>
        </div>

    {% else %}
        <div class="flex flex-col items-center justify-center py-20 bg-gray-50 border border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] relative overflow-hidden group">
            <div class="absolute inset-0 bg-white -z-10 group-hover:bg-gray-50 transition-colors"></div>
            
            <div class="w-24 h-24 bg-white border border-black flex items-center justify-center rounded-full mb-6">
                <span class="material-symbols-outlined text-4xl text-black">package</span>
            </div>
            
            <h3 class="text-3xl font-display font-bold uppercase tracking-tight text-black mb-2">No Purchases Yet</h3>
            <p class="text-gray-500 font-light mb-8 max-w-md text-center">You haven't purchased any study materials yet. Explore our comprehensive library of notes and papers.</p>
            
            <a href="{% url 'ecommerce:marketplace' %}" class="flex cursor-pointer items-center justify-center border border-black bg-black text-white hover:bg-white hover:text-black transition-colors h-14 px-8 text-sm font-bold uppercase tracking-widest shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-1 hover:translate-y-1 gap-2">
                Browse Marketplace <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
            </a>
        </div>
    {% endif %}

</div>
{% endblock %}
