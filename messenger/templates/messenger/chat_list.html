{% extends 'base.html' %}
{% load static %}

{% block title %}Messages - StudyPedia{% endblock %}

{% block content %}
<div class="max-w-[1440px] mx-auto w-full px-4 md:px-8 py-8 flex flex-col md:flex-row gap-8">
    
    <!-- Left Sidebar: Chat List -->
    <aside class="w-full md:w-1/3 lg:w-1/4 flex flex-col gap-6 shrink-0 md:h-[calc(100vh-120px)] md:sticky md:top-24">
        
        <div class="bg-black border border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] flex flex-col h-full overflow-hidden text-white relative">
            
            <div class="p-5 border-b border-gray-800 flex flex-col gap-4 shrink-0">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-display font-light uppercase tracking-widest flex items-center gap-2">
                        <span class="material-symbols-outlined text-2xl">forum</span> Messages
                    </h3>
                    <a href="{% url 'messenger:create_group_chat' %}" class="w-8 h-8 rounded-full border border-gray-600 hover:border-white hover:bg-white hover:text-black flex items-center justify-center transition-colors tooltip-target" title="New Group Chat">
                        <span class="material-symbols-outlined text-[16px]">group_add</span>
                    </a>
                </div>

                <form method="get" class="relative">
                    <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-[18px]">search</span>
                    <input type="text" name="q" class="w-full h-10 bg-gray-900 border border-gray-700 text-white placeholder:text-gray-500 pl-10 pr-4 text-xs font-mono tracking-wide focus:outline-none focus:border-white transition-colors" placeholder="Search chats..." value="{{ search_query|default:'' }}">
                </form>
            </div>

            <div class="flex-1 overflow-y-auto no-scrollbar nice-scrollbar">
                {% for room in page_obj %}
                    {% with other_user=room.participants.exclude(user=user).first.user %}
                    <a href="{% url 'messenger:chat_room' room.id %}" class="flex items-center gap-4 p-4 border-b border-gray-800 hover:bg-gray-900 transition-colors group">
                        <div class="w-12 h-12 rounded-full border border-gray-700 overflow-hidden shrink-0 group-hover:border-white transition-colors relative">
                            {% if other_user.profile_picture %}
                                <img src="{{ other_user.profile_picture.url }}" alt="Avatar" class="w-full h-full object-cover">
                            {% else %}
                                <img src="{% static 'img/default_profile.png' %}" alt="Avatar" class="w-full h-full object-cover grayscale">
                            {% endif %}
                        </div>
                        <div class="flex flex-col flex-1 min-w-0">
                            <h6 class="text-sm font-bold uppercase tracking-wider text-white truncate mb-1">
                                {{ other_user.username }}
                            </h6>
                            <p class="text-xs text-gray-400 truncate max-w-full font-mono group-hover:text-gray-300">
                                {{ room.messages.last.content|default:"No messages yet" }}
                            </p>
                        </div>
                    </a>
                    {% endwith %}
                {% empty %}
                    <div class="py-16 px-6 text-center flex flex-col items-center opacity-60">
                        <span class="material-symbols-outlined text-4xl mb-3 text-gray-500">speaker_notes_off</span>
                        <p class="text-xs font-mono text-gray-400 uppercase tracking-widest leading-relaxed">No conversations started yet.</p>
                    </div>
                {% endfor %}
            </div>

            {% if page_obj.has_next %}
                <div class="p-4 border-t border-gray-800 shrink-0 text-center bg-black">
                    <a href="?page={{ page_obj.next_page_number }}" class="text-[10px] font-bold uppercase tracking-widest text-gray-400 hover:text-white transition-colors pb-1 border-b border-gray-600 hover:border-white">
                        Load More
                    </a>
                </div>
            {% endif %}
        </div>

    </aside>

    <!-- Center Content: Empty State -->
    <main class="w-full md:w-2/3 lg:w-3/4 flex flex-col md:h-[calc(100vh-120px)]">
        <div class="bg-white border text-black border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] flex-1 flex flex-col items-center justify-center p-8 text-center pattern-bg relative overflow-hidden">
            
            <div class="absolute inset-0 opacity-5 pointer-events-none" style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 20px 20px;"></div>

            <div class="w-24 h-24 border border-black bg-white rounded-full flex items-center justify-center mb-6 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] z-10">
                <span class="material-symbols-outlined text-4xl text-black">chat</span>
            </div>
            
            <h2 class="text-2xl font-display font-light uppercase tracking-tight text-black mb-3 z-10">Your Messages</h2>
            <p class="text-sm text-gray-500 font-mono tracking-wide max-w-sm z-10">
                Select a conversation from the sidebar to continue messaging, or start a new chat from someone's profile.
            </p>
            
        </div>
    </main>

</div>
{% endblock %}